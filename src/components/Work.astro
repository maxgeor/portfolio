---
import DancingLetters from './DancingLetters.astro';
import RightArrowIcon from './icons/RightArrowIcon.astro';
import UpRightArrowIcon from './icons/UpRightArrowIcon.astro';
import ComingSoonBanner from './ComingSoonBanner.astro'

type Roles = {
  long: string[],
  short: string[];
}

type Work = {
  title: string;
  description: string;
  roles: Roles;
  link?: {
    href: string;
    target?: '_blank' | '_self';
  };
  year?: string;
  image?: string;
  type?: string;
  studySlug?: string;
  isComingSoon?: boolean;
  classes?: string;
  index?: number;
}

type WorkCard = {
  variant: 'card';
  image: string;
} & Work;

type WorkRow = {
  variant: 'row';
  type: string;
  year: string;
} & Work;

export type Props = WorkCard | WorkRow;

const { 
  title, 
  description, 
  variant,
  type,
  image,
  year,
  link = {
    href: null,
    target: '_blank',
  },
  roles,
  studySlug,
  classes = '',
  isComingSoon = false,
  index
} = Astro.props;

const Element = isComingSoon ? 'div' : 'a';
const props = 
  isComingSoon 
    ? {} 
    : studySlug 
      ? { href: `study/${studySlug}`, target: '_self' } 
      : link 

const rightArrowIconClasses = 
  `inline shrink-0 mr-[4px] -ml-px  ${isComingSoon ? 'opacity-50' : ''}`;

const upRightArrowIconClasses = 
  `inline shrink-0 -ml-px mr-[4px] ${isComingSoon ? 'opacity-50' : ''}`;

---

<!-- {studySlug 
          ? <RightArrowIcon classes={rightArrowIconClasses} /> 
          : <UpRightArrowIcon classes={upRightArrowIconClasses} />
        } -->
{variant === 'card' ? (
  <Element
    {...props}
    class={`
       group overflow-hidden block group relative gap-x-4 h-fit
      ${isComingSoon ? 'cursor-not-allowed' : props.target === '_blank' ? 'cursor-alias' : 'cursor-pointer'}
      ${classes} 
    `}
  >
    <div class={`
      flex justify-between gap-4
      ${!isComingSoon && 'group-hover:bg-black group-hover:text-white'}
    `}>
      <h3 aria-label={`${title} ${isComingSoon ? '(coming soon)' : ''}`}>{title}<sup class="">W{index}</sup> </h3>
      <span class="-mr-1.5 -ml-0.5">
        {studySlug ? (
          <RightArrowIcon classes={rightArrowIconClasses} />
        ) : (
          <UpRightArrowIcon classes={upRightArrowIconClasses} />
        )}
      </span>
    </div>
    <picture class="relative h-auto ">
      <img
        src={image}
        alt={`Preview mockup of ${title}`}
        class={`
          w-full h-full object-top select-none object-contain border
        `}
      />
      {isComingSoon && <ComingSoonBanner classes="-rotate-[12deg]" />}
    </picture>
  </Element>
) : (
  <Element
    {...props}
    class={`
      relative  group col-span-full 
      ${isComingSoon ? 'text-black/50 hover:bg-white hover:text-black' : 'hover:bg-black hover:text-white'}
      ${isComingSoon ? 'cursor-not-allowed' : props.target === '_blank' ? 'cursor-alias' : 'cursor-pointer'}
      ${classes}
    `}
  >
    <div class={`
      grid grid-cols-12 gap-x-4
      ${isComingSoon ? 'group-hover:hidden group-focus:hidden' : ''}
    `}>

      <div class="shrink-0 whitespace-nowrap font-black uppercase  col-span-4 md:col-span-2 h-fit">
        {title}<sup>W{index}</sup>
      </div>
      <p class=" inline-block text-right sm:text-left col-span-7 md:col-span-4 truncate">
        {description}
      </p>
      <div class="hidden md:flex gap-1 col-span-full sm:col-span-3 ml-4.5">
        <span>{roles.long.join(', ')}</span>
      </div>
      <div class="hidden md:inline-block col-span-2 ">
        {type}
      </div>
      <div class="flex gap-2 text-[11px] col-span-1 justify-self-end ">
        {isComingSoon ? "â€”" : year}
        <span class="-mr-1.5 -ml-0.5">
          {studySlug ? (
            <RightArrowIcon classes={rightArrowIconClasses} />
          ) : (
            <UpRightArrowIcon classes={upRightArrowIconClasses} />
          )}
        </span>
      </div>
      
    </div>
    {isComingSoon && (
      <div class="h-4 hidden group-hover:flex group-focus:block">
        <ComingSoonBanner classes="text-black opacity-1" />
      </div>
    )}
  </Element>
)}