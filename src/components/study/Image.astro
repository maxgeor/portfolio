---
import type { ResponsiveNumber, ResponsiveBool } from '../../utils/class-generator'
import { getColClasses, getResponsiveBoolClasses } from '../../utils/class-generator'
import Caption from './Caption.astro';
import clsx from 'clsx';

export interface Props {
  src: string;
  alt: string;
  id: string;
  span?: ResponsiveNumber;
  start?: ResponsiveNumber;
  end?: ResponsiveNumber;
  description?: string;
  hasCaption?: boolean;
  hasBorder?: boolean;
  isPadded?: boolean;
  orientation?: 'horizontal' | 'vertical' | '3/2';
  fullBleed?: ResponsiveBool;
  fit?: 'contain' | 'cover';
  classes?: string;
}

const { 
  src, 
  alt,
  id,
  span = 12,
  start,
  end,
  description = '',
  hasCaption = true,
  orientation = 'horizontal',
  fullBleed = false,
  hasBorder = false,
  isPadded = false,
  fit = 'contain',
  classes = ""
} = Astro.props;

const objectFit = fit === 'contain' ? 'object-contain' : 'object-cover';

let aspectRatio;

switch(orientation) {
  case 'horizontal':
    aspectRatio = 'aspect-[7/4]';
    break;
  case 'vertical':
    aspectRatio = 'aspect-[3/4]';
    break;
  case '3/2':
    aspectRatio = 'aspect-[3/2]';
    break;
  default:
    aspectRatio = 'aspect-[7/4]';
}

const { spanClasses, startClasses, endClasses } = getColClasses(span, start, end);
const { bleedClasses, paddingClasses } = getResponsiveBoolClasses(fullBleed);
---
<div class={clsx(
  "flex flex-col gap-x-4 gap-y-2 h-fit",
  spanClasses,
  startClasses,
  endClasses,
  bleedClasses,
  classes
)}>
  <figure class={clsx(
    'image  relative',
    hasBorder && 'border border-neutral-300 dark:border-neutral-700',
    aspectRatio,
  )}>
    <img
      src={src}
      alt={alt}
      class={clsx(
        'h-full w-full bg-neutral-200 dark:bg-neutral-900 select-none self-center',
        aspectRatio,
        objectFit
      )}
    />
  </figure>
  <div class={clsx(
    (hasCaption || description ? 'flex flex-col gap-x-4 gap-y-4 max-w-[80ch]' : 'hidden'),
    paddingClasses
  )}>
    {hasCaption && <Caption id={id} text={alt} classes='-my-0.5' />}
    {description && <p class="col-span-full -my-0.5">{description}</p>}
  </div>
</div>