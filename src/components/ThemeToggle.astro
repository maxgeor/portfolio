---
import clsx from 'clsx';

export interface Props {
  classes?: string;
}

const { classes = "" } = Astro.props;
---
<button class={clsx(
  "theme-toggle flex md:justify-self-end group uppercase p-2 -m-2",
  classes
)}>
  Light/Dark
</button>

<script>
  const themeToggles = document.querySelectorAll('.theme-toggle');

  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    const newTheme = isDark ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    updateMetaThemeColor(newTheme);
  }

  function loadThemePreference() {
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.classList.toggle('dark', theme === 'dark');
    updateMetaThemeColor(theme);
  }

  function updateMetaThemeColor(theme) {
    const metaThemeColor = document.querySelector('meta[name="theme-color"]');
    if (metaThemeColor) {
      metaThemeColor.content = theme === 'dark' ? '#000' : '#fff';
    } else {
      const newMeta = document.createElement('meta');
      newMeta.name = 'theme-color';
      newMeta.content = theme === 'dark' ? '#000' : '#fff';
      document.head.appendChild(newMeta);
    }
  }

  themeToggles.forEach(toggle => toggle.addEventListener('click', toggleTheme));
  loadThemePreference();
</script>